# ğŸ§¾ è‡ªåŠ¨æ›´æ–°ä¸å‘å¸ƒç³»ç»Ÿè§„åˆ’æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

* **é¡¹ç›®åç§°ï¼š** GodForsaken Save Manager
* **ä»“åº“åœ°å€ï¼ˆç§æœ‰ï¼‰ï¼š** [https://github.com/abevol/godforsaken-save-manager](https://github.com/abevol/godforsaken-save-manager)
* **å¼€å‘è¯­è¨€ä¸æ¡†æ¶ï¼š** Python + PySide6
* **æ‰“åŒ…æ–¹å¼ï¼š** `poetry run nuitka --standalone --onefile ...`
* **ç›®æ ‡å¹³å°ï¼š** Windows 10/11
* **å¯æ‰§è¡Œæ–‡ä»¶åï¼š** `GodForsakenSaveManager.exe`
* **åˆ†å‘ç›®æ ‡ï¼š** ç”¨æˆ·å¯å…¬å¼€è®¿é—®æœ€æ–°ç‰ˆå¯æ‰§è¡Œæ–‡ä»¶å¹¶è‡ªåŠ¨æ›´æ–°
* **æºç ä¿å¯†ï¼š** ä»“åº“ä¿æŒç§æœ‰

---

## 1ï¸âƒ£ ç›®æ ‡ä¸çº¦æŸ

### ğŸ¯ ç›®æ ‡

1. **è‡ªåŠ¨åŒ–æ„å»ºä¸å‘å¸ƒ**

   * å½“ä»“åº“æ‰“ä¸Šæ–° tagï¼ˆä¾‹å¦‚ `v1.4.0`ï¼‰æ—¶ï¼ŒGitHub Actions è‡ªåŠ¨æ‰§è¡Œï¼š

     * æ‹‰å–æºç ï¼›
     * ä½¿ç”¨ Poetry + Nuitka æ„å»ºï¼›
     * ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼›
     * è®¡ç®—æ ¡éªŒä¿¡æ¯ï¼›
     * ç”Ÿæˆ `version.json`ï¼›
     * ä¸Šä¼ åˆ° GitHub Releaseã€‚

2. **è‡ªåŠ¨æ›´æ–°æœºåˆ¶**

   * ç¨‹åºå¯åŠ¨æ—¶æ£€æµ‹è¿œç¨‹æœ€æ–°ç‰ˆæœ¬ï¼›
   * è‹¥æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬ï¼Œæç¤ºç”¨æˆ·ï¼›
   * ä¸‹è½½å¹¶æ‰§è¡Œæ–°ç‰ˆæœ¬å®‰è£…åŒ…ï¼›
   * æ”¯æŒç‰ˆæœ¬æ ¡éªŒï¼ˆSHA256ï¼‰ï¼›
   * è¿‡ç¨‹å…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€å¤–éƒ¨æœåŠ¡å™¨ã€‚

3. **å®Œå…¨å…è´¹æ–¹æ¡ˆ**

   * æ‰€æœ‰åŸºç¡€è®¾æ–½å‡ä½¿ç”¨ GitHub æä¾›çš„å…è´¹åŠŸèƒ½ï¼›
   * æ— éœ€ AWS/S3/OSS/CDNï¼›
   * æ›´æ–°æ–‡ä»¶é€šè¿‡ GitHub Release å…¬ç½‘ä¸‹è½½ã€‚

---

## 2ï¸âƒ£ æ¶æ„è®¾è®¡

### ç³»ç»Ÿç»„æˆ

| æ¨¡å—                      | è¯´æ˜                             |
| ----------------------- | ------------------------------ |
| **æºç ä»“åº“ (ç§æœ‰)**           | å­˜æ”¾æºä»£ç ä¸ CI é…ç½®æ–‡ä»¶                 |
| **GitHub Actions**      | è‡ªåŠ¨åŒ–æ„å»ºã€å‘å¸ƒã€ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯                |
| **GitHub Release (å…¬å¼€)** | æ‰˜ç®¡å·²ç¼–è¯‘çš„ `.exe` ä¸ `version.json` |
| **å®¢æˆ·ç«¯æ›´æ–°æ¨¡å—**             | æ£€æŸ¥æ–°ç‰ˆæœ¬ã€ä¸‹è½½ã€éªŒè¯ã€æ‰§è¡Œæ›´æ–°               |

### äº¤äº’æµç¨‹

```
[ç”¨æˆ·åº”ç”¨å¯åŠ¨]
        â”‚
        â–¼
æ£€æŸ¥è¿œç¨‹ version.jsonï¼ˆGitHub Releaseï¼‰
        â”‚
   æ˜¯å¦æœ‰æ›´æ–°ï¼Ÿ
      /   \
    å¦     æ˜¯
    â”‚      â–¼
    â”‚  ä¸‹è½½æ–°ç‰ˆæœ¬ .exe
    â”‚      â”‚
    â”‚  æ ¡éªŒå“ˆå¸Œå€¼
    â”‚      â”‚
    â”‚  è‡ªåŠ¨å¯åŠ¨æ–°ç‰ˆæœ¬å®‰è£…ç¨‹åº
    â–¼
ç»§ç»­è¿è¡Œç¨‹åº
```

---

## 3ï¸âƒ£ æ–‡ä»¶ä¸æ¥å£è§„èŒƒ

### ğŸ”¹ version.json æ ¼å¼

å­˜æ”¾åœ¨æ¯æ¬¡å‘å¸ƒçš„ Release é™„ä»¶ä¸­ï¼š

```json
{
  "version": "1.4.0",
  "notes": "æ”¹è¿› UIã€ä¿®å¤å­˜æ¡£è¯†åˆ«é€»è¾‘",
  "url": "https://github.com/abevol/godforsaken-save-manager/releases/download/v1.4.0/GodForsakenSaveManager.exe",
  "sha256": "2a7bde1d3d4e70f5b8c2a12345678abcd9e...",
  "timestamp": "2025-11-09T10:30:00Z"
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ          | ç±»å‹     | è¯´æ˜                   |
| ----------- | ------ | -------------------- |
| `version`   | string | ç‰ˆæœ¬å·ï¼Œå¿…é¡»ä¸ tag åå¯¹åº”      |
| `notes`     | string | æ›´æ–°è¯´æ˜                 |
| `url`       | string | å¯æ‰§è¡Œæ–‡ä»¶çš„å…¬ç½‘ä¸‹è½½åœ°å€         |
| `sha256`    | string | æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒç              |
| `timestamp` | string | æ„å»ºæ—¶é—´ï¼ˆUTC ISO8601 æ ¼å¼ï¼‰ |

---

## 4ï¸âƒ£ è‡ªåŠ¨åŒ–æ„å»ºæµç¨‹ï¼ˆGitHub Actionsï¼‰

### âœ… è§¦å‘æ¡ä»¶

* å½“æ¨é€ tagï¼ˆæ ¼å¼ `vX.Y.Z`ï¼‰åˆ°ä¸»åˆ†æ”¯æ—¶è‡ªåŠ¨è¿è¡Œã€‚

### âœ… ç¯å¢ƒè¦æ±‚

* Windows Runner
* Python 3.11
* Poetry å·²å®‰è£…
* Nuitka ç¼–è¯‘å™¨å¯ç”¨

### âœ… å…³é”®æ­¥éª¤

1. **æ£€å‡ºä»£ç **

   ```yaml
   - uses: actions/checkout@v4
   ```

2. **å®‰è£… Poetry ä¸ä¾èµ–**

   ```yaml
   - run: |
       pip install poetry
       poetry install
   ```

3. **ä½¿ç”¨ Nuitka æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶**

   ```yaml
   - run: |
       poetry run nuitka --standalone --onefile --output-filename=GodForsakenSaveManager.exe main.py
   ```

4. **è®¡ç®— SHA256 æ ¡éªŒå€¼**

   ```yaml
   - id: hash
     run: |
       echo "sha256=$(CertUtil -hashfile GodForsakenSaveManager.exe SHA256 | findstr /v SHA256)" >> $GITHUB_OUTPUT
   ```

5. **ç”Ÿæˆ version.json**

   ```yaml
   - run: |
       echo "{ \"version\": \"${GITHUB_REF#refs/tags/v}\", \
       \"notes\": \"è‡ªåŠ¨æ„å»ºå‘å¸ƒç‰ˆæœ¬\", \
       \"url\": \"https://github.com/${{ github.repository }}/releases/download/${GITHUB_REF#refs/tags/v}/GodForsakenSaveManager.exe\", \
       \"sha256\": \"${{ steps.hash.outputs.sha256 }}\", \
       \"timestamp\": \"$(Get-Date -Format o)\" }" > version.json
   ```

6. **å‘å¸ƒ Release**

   ```yaml
   - uses: softprops/action-gh-release@v2
     with:
       tag_name: ${{ github.ref_name }}
       name: "Release ${{ github.ref_name }}"
       body: "è‡ªåŠ¨æ„å»ºå¹¶å‘å¸ƒ"
       files: |
         GodForsakenSaveManager.exe
         version.json
     env:
       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
   ```

---

## 5ï¸âƒ£ å®¢æˆ·ç«¯æ›´æ–°æ¨¡å—è®¾è®¡

### æ¨¡å—ä½ç½®

* æ–‡ä»¶åï¼š`updater.py`
* åœ¨ä¸»ç¨‹åºå¯åŠ¨æ—¶å¯¼å…¥å¹¶è°ƒç”¨ã€‚

### é€»è¾‘æµç¨‹

1. è®¿é—®ï¼š

   ```
   https://api.github.com/repos/abevol/godforsaken-save-manager/releases/latest
   ```
2. æå–ï¼š

   * æœ€æ–°ç‰ˆæœ¬å·ï¼ˆ`tag_name`ï¼‰
   * é™„ä»¶ä¸­çš„ `version.json`
3. å¯¹æ¯”æœ¬åœ°ç‰ˆæœ¬å·ï¼›
4. å¦‚æœè¿œç¨‹ç‰ˆæœ¬æ›´æ–°ï¼š

   * ä¸‹è½½æ–° `.exe`
   * æ ¡éªŒ SHA256ï¼›
   * æç¤ºç”¨æˆ·å¹¶æ‰§è¡Œæ–°ç‰ˆæœ¬ï¼›
   * é€€å‡ºå½“å‰è¿›ç¨‹ã€‚

---

### ç¤ºä¾‹ä¼ªä»£ç 

```python
import requests, tempfile, os, sys, subprocess, hashlib

CURRENT_VERSION = "1.3.0"
VERSION_API = "https://api.github.com/repos/abevol/godforsaken-save-manager/releases/latest"

def check_for_update():
    data = requests.get(VERSION_API).json()
    version = data["tag_name"].lstrip("v")
    if version != CURRENT_VERSION:
        asset = next(a for a in data["assets"] if a["name"] == "version.json")
        version_info = requests.get(asset["browser_download_url"]).json()
        return version_info
    return None

def download_and_verify(info):
    exe_url = info["url"]
    target = os.path.join(tempfile.gettempdir(), "GodForsakenSaveManager_new.exe")
    with requests.get(exe_url, stream=True) as r:
        with open(target, "wb") as f:
            for chunk in r.iter_content(8192):
                f.write(chunk)
    # æ ¡éªŒ
    sha = hashlib.sha256(open(target, "rb").read()).hexdigest()
    if sha.lower() != info["sha256"].lower():
        raise ValueError("æ–‡ä»¶æ ¡éªŒå¤±è´¥")
    subprocess.Popen([target], shell=True)
    sys.exit(0)
```

---

## 6ï¸âƒ£ ç‰ˆæœ¬ç®¡ç†è§„èŒƒ

| å…ƒç´            | è¯´æ˜                           |
| ------------ | ---------------------------- |
| Tag å‘½å       | `vX.Y.Z`ï¼Œä¾‹å¦‚ `v1.4.0`         |
| åˆ†æ”¯ç­–ç•¥         | æ‰€æœ‰æ­£å¼ç‰ˆæœ¬ä» `main` åˆ†æ”¯æ‰“ tag       |
| Release è‡ªåŠ¨å‘½å | â€œRelease vX.Y.Zâ€             |
| æ„å»ºè¾“å‡º         | `GodForsakenSaveManager.exe` |
| Version å­˜å‚¨   | ä¸»ç¨‹åºä¸­å¸¸é‡ + `version.txt` æ–‡ä»¶    |

---

## 7ï¸âƒ£ å®‰å…¨ä¸ç¨³å®šæ€§

| é¡¹ç›®     | æªæ–½                 |
| ------ | ------------------ |
| æºç ä¿æŠ¤   | ä»“åº“ä¿æŒç§æœ‰             |
| æ›´æ–°æ–‡ä»¶æ ¡éªŒ | æ¯æ¬¡æ›´æ–°æ ¡éªŒ SHA256      |
| ç‰ˆæœ¬ä¿¡æ¯æ¥æº | ä»…ä¿¡ä»» GitHub å®˜æ–¹ API  |
| ç”¨æˆ·ä½“éªŒ   | è‡ªåŠ¨æ£€æµ‹æ›´æ–°ã€å¯é€‰æç¤ºæ›´æ–°      |
| æˆæœ¬æ§åˆ¶   | æ‰€æœ‰æ­¥éª¤åŸºäº GitHub å…è´¹é…é¢ |

---

## 8ï¸âƒ£ æ‰©å±•åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

| åŠŸèƒ½      | è¯´æ˜                                              |
| ------- | ----------------------------------------------- |
| å¤šè¯­è¨€æ›´æ–°æ—¥å¿— | `version.json` å¯åŠ å…¥ `notes_zh` / `notes_en`      |
| è‡ªåŠ¨æ¨é€é€šçŸ¥  | ä½¿ç”¨ GitHub Actions è°ƒç”¨ Discord / Telegram Webhook |
| å¢é‡æ›´æ–°    | å°†æ¥å¯é€šè¿‡å·®åˆ†è¡¥ä¸æ–‡ä»¶å®ç°ï¼ˆéå½“å‰é˜¶æ®µé‡ç‚¹ï¼‰                          |
| ç‰ˆæœ¬å›é€€æœºåˆ¶  | é€šè¿‡ä¿ç•™å†å² release å®ç°æ‰‹åŠ¨å›é€€                           |

---

## âœ… ç»“è®º

æœ¬æ–¹æ¡ˆï¼š

* ä¿æŒé¡¹ç›®å®Œå…¨é—­æºï¼›
* è‡ªåŠ¨æ„å»ºä¸å‘å¸ƒï¼›
* å¯æ‰§è¡Œæ–‡ä»¶å…¬å¼€å¯ä¸‹è½½ï¼›
* æ— éœ€é¢å¤–è´¹ç”¨ï¼›
* æ”¯æŒè‡ªåŠ¨æ›´æ–°å’Œç‰ˆæœ¬æ ¡éªŒï¼›
* æ˜“äºåç»­æ‰©å±•ä¸ç»´æŠ¤ã€‚
